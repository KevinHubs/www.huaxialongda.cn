(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4575863c"],{"0705":function(t,s,e){},a86a:function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"login"},[e("div",{staticClass:"content"},[e("div",{staticClass:"contenter"},[t._m(0),e("div",{staticClass:"login_right"},[e("div",{staticClass:"rcode"},[e("div",{staticClass:"validation"},[1==t.isShow?e("h3",[t._v("手机验证码登录")]):e("h3",[t._v(t._s(t.tipInfo))])]),1==this.isShow?e("div",[e("div",{staticClass:"phone"},[e("el-input",{attrs:{placeholder:"请输入手机号"},model:{value:t.phoneNum,callback:function(s){t.phoneNum=s},expression:"phoneNum"}}),e("div",{staticClass:"send"},[e("a",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"getCode light-text",attrs:{href:"javascript:void(0)"},on:{click:t.sendCode}},[t._v("获取验证码")]),e("a",{directives:[{name:"show",rawName:"v-show",value:!t.show,expression:"!show"}],staticClass:"getCode light-text",attrs:{href:"javascript:void(0)"}},[t._v(t._s(t.count+"后重新发送"))])])],1),e("div",{staticClass:"code"},[e("el-input",{attrs:{placeholder:"请输入验证码"},model:{value:t.codeNum,callback:function(s){t.codeNum=s},expression:"codeNum"}})],1),e("button",{on:{click:t.login}},[t._v("登录")])]):e("div",{staticClass:"cosignhow"},[e("QrcodeVue",{staticClass:"qrCode",attrs:{value:t.qrText,size:"100"}})],1)])])])])])},n=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"login_left"},[e("div",{staticClass:"logo"},[e("span",{staticClass:"iconfont icon-lihansongjing theme-text"})]),e("div",{staticClass:"titles"},[t._v("发现经典之美")])])}],o=e("d7b0"),a={data:function(){return{qrText:"",isShow:!1,phoneNum:"",codeNum:"",show:!0,count:"",timer:null,tipInfo:"扫码登录"}},mounted:function(){var t="";t="https://dock.lihan.ltd",this.API=t,this.scanLogin()},methods:{scanLogin:function(){var t=this,s=this,e=this.API+"/wander/classic/user/qr?type=pc";this.$axios.get(e).then((function(e){var i=e.data;console.log(i),"suc"==i.result&&("success"==i.msg&&(s.qrText=i.data.raw,s.runComet()),"login"==i.msg&&(t.$router.push({path:"/index"}),s.getUserInfo()))})).catch((function(t){console.log(t)}))},runComet:function(){var t=this,s=this.API+"/wander/classic/user/tick",e=this;this.$axios.get(s).then((function(s){var i=s.data;console.log(i),"suc"===i.result?("success"!=i.msg&&"login"!=i.msg||(e.tipInfo="登录成功",t.$router.push({path:"/index"}),localStorage.setItem("sessionId",JSON.stringify(i.data.session)),localStorage.setItem("key",JSON.stringify(i.data.key)),t.$store.commit("setSessionKey",i.data.session),t.$store.commit("setKey",i.data.key),e.getUserInfo()),"continue"==i.msg&&e.runComet()):"register"===i.result?(e.qrText="https://m.lihan.ltd",e.tipInfo="请扫码注册"):e.runComet()})).catch((function(t){console.log(t)}))},intervalQuery:function(){var t=this,s=this.APIURL+"/wander/classic/user/tick",e=this;this.$axios.get(s).then((function(s){var i=s.data;console.log(i),"success"!=i.msg&&"login"!=i.msg||(e.tipInfo="登录成功",clearTimeout(e.interva),e.getUserInfo(),setTimeout((function(){this.$router.push({path:"/index"})}),1e3)),"continue"==i.msg&&(t.interva=setTimeout((function(){e.intervalQuery()}),5e3))})).catch((function(t){console.log(t)}))},setInterval:function(){var t=this;this.interva=setTimeout((function(){t.intervalQuery()}),5e3)},getUserInfo:function(){var t=this,s=this.APIURL+"/classic/usr/user/info";this.$axios.post(s,"",{headers:{SessionKey:this.SessionKey,key:this.key}}).then((function(s){var e=s.data;console.log(e),"suc"==e.result&&(localStorage.setItem("userInfo",JSON.stringify(e.data)),t.$store.commit("setUserInfo",e.data))}))}},computed:{SessionKey:function(){return this.$store.state.SessionKey},key:function(){return this.$store.state.key}},watch:{SessionKey:function(){this.scanLogin()}},components:{QrcodeVue:o["a"]}},c=a,r=(e("bc24"),e("2877")),l=Object(r["a"])(c,i,n,!1,null,null,null);s["default"]=l.exports},bc24:function(t,s,e){"use strict";var i=e("0705"),n=e.n(i);n.a}}]);
//# sourceMappingURL=chunk-4575863c.feadd472.js.map